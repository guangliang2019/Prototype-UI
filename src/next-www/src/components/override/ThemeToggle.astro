---
// const labelLight = Astro.locals?.t?.('themeSelect.light') ?? 'Light theme';
// const labelDark = Astro.locals?.t?.('themeSelect.dark') ?? 'Dark theme';
---

<button
  data-slot="button"
  class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 group/toggle extend-touch-target size-8"
  type="button"
  aria-label="Toggle color theme"
  aria-pressed="false"
  title="Toggle color theme"
>
  <!-- 初始占位，避免布局跳动；首帧由 hydrate 脚本替换为对应图标 -->
  <span class="sr-only">Toggle theme</span>
</button>


<script is:inline>
  (function () {
    const btn = document.currentScript.previousElementSibling;
    const tmpl = document.getElementById('starlight-theme-icons');

    function iconFor(theme) {
      if (!tmpl) return null;
      const el = tmpl.content.querySelector('.' + theme);
      return el ? el.cloneNode(true) : null;
    }

    function render(theme) {
      const icon = iconFor(theme);
      if (icon) {
        btn.replaceChildren(icon);
        // 无障碍文案与 pressed 状态
        const isDark = theme === 'dark';
        btn.setAttribute('aria-pressed', String(isDark));
        btn.setAttribute(
          'aria-label',
          isDark ? /* 下一步切换目标的说明更友好 */ 'Switch to light theme' : 'Switch to dark theme'
        );
        btn.setAttribute('title', isDark ? 'Switch to light theme' : 'Switch to dark theme');
      }
    }

    function current() {
      return (
        window.StarlightTheme?.get?.() ||
        (document.documentElement.dataset.theme === 'light' ? 'light' : 'dark')
      );
    }

    // 首次渲染
    render(current());

    // 点击切换
    btn.addEventListener('click', () => {
      window.StarlightTheme.toggle();
    });

    // 响应全局变更（来自其它控件）
    document.addEventListener('starlight-theme:change', (e) => {
      render(e.detail.theme);
    });

    // Provider 主动触发的首帧对齐（可选）
    document.addEventListener('starlight-theme:hydrate', () => {
      render(current());
    });
  })();
</script>
